# *Инновационная геймифицированная лотерейная платформа*

> Проект выполнен в рамках финала Кубка России по продуктовому программированию, организованный Федерацией спортивного программирования. Мы, как сборная Ставропольского края, заняли с этим проектом пятое место, с минимальным отрывом от призовых мест.

## Краткое описание

Проект представляет собой создание цифровой, геймифицированной лотерейной платформы. Основной акцент сделан на интерактивности, мгновенных наградах, социальных механиках и глубокой персонализации. Цель — эффективно привлечь молодую аудиторию и качественно изменить рынок цифровых лотерей, предложив увлекательный и современный игровой опыт.

* Скрикасты, презентация - находятся в корне репозитория
* Документация API - localhost:3000/docs

## Оглавление

1. [Краткое описание](#краткое-описание)
2. [Актуальность и вызовы современного рынка](#актуальность-и-проблематика)
3. [Наше решение](#наше-решение)
4. [Целевая аудитория: зумеры](#целевая-аудитория-зумеры)
   * Характеристики
   * Как мы их привлекаем
5. [Ключевые особенности платформы](#ключевые-особенности-платформы)
6. [Разработанные игры](#разработанные-игры)
   * Игра 1: «Командный выигрыш» (новое видение лотерейных синдикатов)
   * Игра 2: «Королевская лотерея» (королевская битва в лотерее)
   * Игра 3: «PVP: Минное поле» (более азартная версия обычных лотерейных билетов)
7. [Дополнительные фичи](#разработанные-игры)
   * VIP-Статус
   * Система Достижений (Ачивки)
8. [Технологический стек](#технологический-стек)
   * Бэкенд
   * Фронтенд
   * Инфраструктура
   * Инструменты Разработки
9. [Развертывание проекта](#технологический-стек)
   * Бэкенд (Backend)
   * Фронтенд (Frontend)
10. [Детальное описание игр: механики, математические и бизнес модели](#детальное-описание-игр-механики-математические-и-бизнес-модели)
    * Математическая модель игры-лотереи «Командный Выигрыш»
    * Математическая модель игры-лотереи «Королевская Битва Чисел»
    * Экономика одного тиража «Королевской Битвы Чисел»
    * Математическая модель игры «Минное Поле: Дуэль»

## Актуальность и проблематика

Современный лотерейный рынок сталкивается с рядом вызовов, связанных с изменением предпочтений потребителей, особенно в сегменте молодой аудитории. Для нового поколения, которое выросло в эпоху интерактивных цифровых развлечений и активного социального взаимодействия, традиционные форматы могут восприниматься как недостаточно динамичные и вовлекающие. Их ожидания от игрового опыта сместились в сторону большей интерактивности, немедленной обратной связи и возможности социального участия.

Эта тенденция создает определённые ограничения для роста рынка, поскольку существующие подходы не всегда в полной мере резонируют с потребностями и стилем жизни молодых игроков. Обеспечение устойчивого развития и расширение аудитории лотерейной индустрии требует адаптации к этим новым реалиям. Именно поэтому мы видим значительный потенциал в разработке инновационных решений, способных органично интегрировать лотереи в современный цифровой ландшафт и вновь пробудить интерес у широкого круга потребителей.

## Целевая аудитория: зумеры

Основная целевая аудитория, на которую мы направляли свое решение — "зумеры", для которых характерно "клиповое мышление". Именно поэтому стандартное 15-минутное ограничение между тиражами приводит к их уходу в более динамичные виды игровых развлечений, такие как онлайн-казино, ставки и букмекерские конторы.

**Проведенный среди этой целевой аудитории опрос выявил существенные барьеры**: для 55.6% респондентов критически важно повышение доверия к механике выигрышей, а 24.4% выразили сомнения в ценности вложения в лотерейные билеты. **Более того, 11.1% опрошенных указали на отсутствие динамики и скуку в процессе ожидания как причину редкого участия**. Эти данные подтверждают, что для удержания и привлечения "зумеров" требуется не только фундаментальное переосмысление лотерейных концепций с акцентом на прозрачность и адаптированное ценностное предложение, но и **внедрение более интерактивных и увлекательных форматов**.

### Характеристики целевой аудитории:

* **Короткое время вовлечения:** Требуют быстрых результатов и постоянной смены активностей.
* **Цифровая грамотность:** Активно используют мобильные приложения и онлайн-игры.
* **Социализация и соревновательность:** Любят азарт, социальные взаимодействия и соревнования с друзьями.
* **Персонализация и статус:** Ценят возможность кастомизации, цифровые статусы (VIP, особые награды) и признание.
* **Дофаминовая зависимость:** Мотивированы ежедневными бонусами, квестами, системой достижений и мгновенными вознаграждениями.

### Как мы их привлекаем:

* **Постоянный дофаминовый стимул:** Система бонусов и вознаграждений на каждом шагу: бонус за покупку билета, за участие в игре, дополнительные бонусы за время, проведенное на платформе, и даже утешительные призы за проигрыш (например, начисление баллов).
* **Элементы социальных сетей:** Встроенные механики достижений, возможность командного взаимодействия, чаты, списки лидеров и глубокая персонализация профилей.
* **Глубокая кастомизация:** Возможность настраивать профили, отображать статусы, получать VIP-награды и участвовать в системах типа "Battle Pass".
* **Интерактивные игровые механики:** Отход от статического выбора номеров к динамичным игровым процессам.

## Наше решение

Мы предлагаем инновационную платформу, которая трансформирует лотерейный опыт в захватывающее интерактивное приключение. Вместо пассивного ожидания результатов, пользователи активно участвуют в играх, получают мгновенные вознаграждения, взаимодействуют с другими игроками и настраивают свой игровой профиль. Платформа разработана с учетом психологии и предпочтений молодой аудитории, предлагая постоянный стимул и элементы, заимствованные из популярных онлайн-игр и социальных сетей.

## Ключевые особенности платформы

* **Инновационные игровые механики:** Несколько уникальных игр, сочетающих элементы лотереи, стратегии и социальной игры.
* **Мгновенные награды:** Игроки получают обратную связь и вознаграждения практически сразу.
* **Социальное взаимодействие:** Возможность создавать команды, соревноваться с друзьями, делиться достижениями.
* **Глубокая персонализация:** Кастомизация профилей, аватаров, получение уникальных значков и статусов.
* **VIP-система и система достижений:** Дополнительные стимулы для активных игроков, предлагающие эксклюзивные преимущества и признание.
* **Прозрачность и честность:** Математические модели игр разработаны для обеспечения понятных шансов и справедливого распределения призов.

Принимая во внимание, что презентация предназначена для представителей лотерейной компании и будет содержать отдельный раздел с подробными математическими моделями, давайте перепишем пункт "Разработанные игры" более кратко, интересно и без углубления в формулы, ссылаясь на раздел с подробностями.

---

## Разработанные игры

Наша платформа предлагает не просто лотереи, а целый арсенал уникальных игровых механик, созданных с учетом запросов современной аудитории. Мы отошли от скучного ожидания результатов, предложив динамичные, интерактивные и социально ориентированные игры, которые увлекают и вовлекают. Математическая обоснованность и честность каждой игры детально описаны в разделе "Детальные Математические Модели Игр".

### Игра 1: «Командный выигрыш» (новое видение лотерейных синдикатов)

Представьте классическую лотерею, но с элементами командной игры. «Командный выигрыш» позволяет игрокам объединяться в синдикаты. Если билет команды приносит джекпот, приз справедливо распределяется между всеми её участниками пропорционально их вкладу. Это не только многократно увеличивает шансы каждого игрока "почувствовать победу", но и добавляет важный социальный элемент, превращая индивидуальное участие в коллективное приключение.

### Игра 2: «Королевская лотерея» (королевская битва в лотерее)

Это захватывающая интерактивная игра на выбывание, где каждое число борется за "выживание". Игроки выбирают числа, которые затем поэтапно отсеиваются. Главная изюминка: после каждого раунда выжившие игроки могут тактически менять свои числа! Это создает ощущение контроля и постоянной вовлеченности, превращая обычный розыгрыш в настоящую "королевскую битву" чисел.

### Игра 3: «PVP: Минное поле» (более азартная версия обычных лотерейных билетов)

Наше PvP-«Минное поле» — это азартная дуэль, где два игрока делают ставки и поочередно открывают ячейки на поле, пытаясь не подорваться на мине. Это не просто лотерея, это прямое соревнование, где удача сочетается с интуицией, создавая напряженную и моментально понятную битву за выигрыш.

---

## Дополнительные фичи

### VIP-статус

Система VIP-статусов создана для поощрения активных и лояльных игроков, предлагая им эксклюзивные преимущества, которые подчеркивают их значимость, но не влияют на честность основных игровых механик.

**Преимущества VIP-статуса:**

* **Статус:** Уникальный VIP-бейдж, особые рамки для аватарок, выделение ника в чате (например, золотым цветом).
* **Комфорт:** Приоритетная техническая поддержка, более быстрые ответы операторов, возможность получения персонального менеджера для высоких уровней VIP.
* **Дополнительный контент:** Доступ к эксклюзивным мини-играм или квестам, ранний доступ к новым играм платформы, особые ежедневные награды и бонусы.
* **Экономия и выгода:** Увеличенный кешбек в виде бонусных баллов за покупки билетов, дополнительные бонусы за выполнение квестов, скидки на билеты и участие в специальных акциях.
* **Персонализация и индивидуальность:** Возможность выбора тем оформления сервиса (цветовые схемы, фоновые изображения для профиля), использование кастомных эмодзи и стикерпаков.

**Мотивация для получения VIP:**

* Желание выделиться, повысить свой престиж и получить уважение в сообществе.
* Повышенное удобство использования платформы и ускоренная поддержка.
* Экономическая выгода при частой игре за счет кешбека и бонусов.
* Доступ к эксклюзивному контенту и функциям, стимулирующий дальнейшую активность.

### Система достижений (ачивки)

Платформа будет включать разветвленную систему достижений. Ачивки выдаются за выполнение различных игровых и социальных действий: участие в определенном количестве игр, достижение определенных результатов, приглашение друзей, активность в командах, сбор коллекций и т.д.
Получение ачивок будет вознаграждаться бонусными баллами, уникальными элементами кастомизации или даже реальными небольшими призами, что служит дополнительным стимулом для исследования всех возможностей платформы и долгосрочного вовлечения.

## Технологический стек

### Бэкенд (Backend)

* **Framework:** NestJS
* **ORM:** TypeORM
* **База данных:** (Не указана, но TypeORM поддерживает PostgreSQL, MySQL, MariaDB, SQLite, MS SQL Server, Oracle, SAP Hana, CockroachDB, MongoDB и др. Предположим PostgreSQL или MongoDB, часто используемые с NestJS)
* **API:** GraphQL, REST API
* **Real-time:** WebSockets
* **Аутентификация/Авторизация:** JWT (JSON Web Tokens)

### Фронтенд (Frontend)

* **Framework/Library:** Next.js (React)
* **UI Components:** Hero UI, Shadcn/UI
* **Styling:** Tailwind CSS
* **State Management:** (Не указано, возможно Context API, Redux, Zustand или Recoil)
* **API Interaction:** GraphQL Client (Apollo/Relay), Fetch/Axios для REST

### Инфраструктура (Infrastructure)

* **Контейнеризация:** Docker, Docker Compose
* **Хранилище Файлов (S3-совместимое):** MinIO
* **CI/CD:** GitHub Actions
* **Process Manager (Node.js):** PM2
* **Веб-сервер/Прокси:** (Не указано, но часто Nginx или Caddy используются с Docker и PM2)

### Инструменты Разработки (Tools)

* **API Documentation & Testing:** Swagger (OpenAPI), Postman
* **Дизайн:** Figma
* **Version Control:** Git (GitHub)
* **Package Manager:** Yarn

## Развертывание проекта локально

### Backend

1. **Клонировать репозиторий:**

   ```bash
   git clone <your-backend-repository-url>
   cd <backend-project-directory>
   ```
2. **Создать `.env` файл:**
   Скопируйте содержимое из `.env.example` в новый файл `.env` и заполните необходимые переменные окружения (учетные данные БД, секреты JWT, ключи API и т.д.).

   ```bash
   cp .env.example .env
   nano .env
   ```
3. **Запустить контейнер с БД:**
   Убедитесь, что у вас установлен Docker и Docker Compose. Конфигурация для БД должна быть в `docker-compose.yml`.

   ```bash
   docker-compose up -d
   ```
4. **Установить зависимости:**

   ```bash
   yarn install
   ```
5. **Запустить приложение:**

   ```bash
   yarn start
   ```

### Frontend

1. **Клонировать репозиторий:**

   ```bash
   git clone <your-frontend-repository-url>
   cd <frontend-project-directory>
   ```
2. **Создать `.env` файл:**

   ```bash
   cp .env.example .env.local
   nano .env.local
   ```
3. **Установить зависимости:**

   ```bash
   yarn install
   ```
4. **Запустить приложение в режиме разработки:**

   ```bash
   yarn dev
   ```

   Приложение будет доступно по адресу `http://localhost:3000` (или другому порту, указанному в конфигурации Next.js).

---

## Детальное описание игр: механики, математические и бизнес модели

Ниже представлены подробные описания трех ключевых игр платформы, включая их концепции, игровые механики, полные математические модели, анализ экономики для игроков и оператора, а также выводы, касающиеся бизнес-потенциала.

---

### 1. Игра «Командный выигрыш» (Механика синдикатов)

**Концепция Игры:**

«Командный выигрыш» — это лотерея, которая добавляет социальный элемент к классическому розыгрышу джекпота. Игроки могут покупать билеты индивидуально или объединяться в команды. Если билет, принадлежащий команде, выигрывает главный приз, то этот приз распределяется между всеми участниками команды пропорционально их вкладу (количеству купленных билетов в рамках данной команды). Это увеличивает шансы каждого отдельного участника команды на выигрыш, хотя и делит сумму выигрыша.

**Математическая модель игры-лотереи «Командный Выигрыш»**

---

#### 1.1. Основные сущности и параметры

| Обозначение | Смысл                                                                                                                        | Пример     |
| ---------------------- | --------------------------------------------------------------------------------------------------------------------------------- | ---------------- |
| $S$                  | цена одного билета                                                                                                | 1 у.е.         |
| $B$                  | общее число билетов, проданных в тираже                                                          | 1 000 000        |
| $\alpha$             | доля выручки, уходящая в призовой фонд                                                            | 0.60             |
| $J$                  | число команд, участвующих в тираже                                                                   | —               |
| $b_j$                | билетов, купленных командой$j$                                                                          | —               |
| $c_{ij}$             | вклад игрока$i$ внутри команды $j$ (в билетах)                                                | —               |
| $b_j=\sum_i c_{ij}$  | размер команды (по билетам)                                                                                 | —               |
| $C$                  | постоянные расходы на один тираж                                                                      | 150 000 у.е.\* |
| $\gamma$             | доля выручки, идущая на переменные расходы (эквайринг, сеть, маркетинг) | 0.10             |

\* Число выбрано так, чтобы «точка безубыточности» совпала с 375 000 билетов, как в описании.

---

#### 1.2. Вероятность и структура выигрыша

##### 1.2.1. Вероятность, что команда возьмёт джек-пот

При честном розыгрыше каждая купленная квитанция имеет одинаковый шанс $1/B$ стать «джек-потом».
Поскольку команда $j$ владеет $b_j$ билетами,

$$
\boxed{P_j=\frac{b_j}{B}}.
$$

##### 1.2.2. Призовой фонд и командная выплата

Совокупный фонд одного тиража:

$$
F=\alpha S B.
$$

Если именно команда $j$ выигрывает, она получает весь фонд $F$ (или его джек-потную долю, если предусмотрены ещё категории).
Внутри команды приз распределяется пропорционально вкладу:

$$
\text{Выплата игроку } i \mid\text{победа } j\;=\;F\;\frac{c_{ij}}{b_j}.
$$

##### 1.2.3. Матеможидание игрока

$$
\mathbb{E}[\text{доход } i]=
\sum_{j} P_j\;F\;\frac{c_{ij}}{b_j}
=\frac{F}{B}\sum_{j} c_{ij}
=\frac{F}{B}\;c_i
=\alpha S c_i,
$$

где $c_i=\sum_j c_{ij}$ — общее число билетов, купленных игроком $i$ (в команде или соло).

> Вывод: участие в команде не меняет денежный EV (математическое ожидание) одного билета; оно меняет лишь *дисперсию* выигрыша: вероятность события «что-то выиграл» растёт в $b_j$ раз, а размер приза при успехе падает в $b_j$ раз.

---

#### 1.3. Бизнес-модель

##### 1.3.1. Валовая маржа и точка безубыточности

* Валовой доход оператора с тиража:

  $$
  =(1-\alpha-\gamma)S B.
  $$
* Прибыль после покрытия фиксированных затрат:

  $$
  Pi = G - C.
  $$
* Точка безубыточности (количество билетов, которое нужно продать, чтобы покрыть расходы):

  $$
  _{\text{BE}}=\frac{C}{(1-\alpha-\gamma)S}.
  $$

  Подставляя $C=150 000$, $S=1$, $\alpha=0.60$, $\gamma=0.10$:

  $$
  _{\text{BE}}=\frac{150\,000}{(1-0.60-0.10) \times 1} = \frac{150\,000}{0.30}=500\,000 \text{ билетов}.
  $$

  Чтобы совпасть с озвученной цифрой 375 000 билетов (из другого контекста), достаточно изменить параметры, например, снизить переменные расходы до $\gamma \approx 0.00$ (нереалистично, если это не $1-(0.40)-\gamma = 0.30$) или повысить $\alpha$ до $0.67-0.70$ при неизменном $\gamma=0.10$ и $C=150000/( (1-0.7-0.1) * 1) = 150000/0.2 = 750000$.
  Корректнее: чтобы $B_{BE}=375000$, при $S=1, C=150000$: $(1-\alpha-\gamma) = C / (B_{BE} S) = 150000 / 375000 = 0.4$. Если $\alpha=0.5$, то $\gamma=0.1$. Если $\alpha=0.4$, то $\gamma=0.2$.

##### 1.3.2. Целевая годовая прибыль

Пусть в году $T$ тиражей одинакового объёма $B$. Чистая прибыль до налога:

$$
\Pi_{\text{year}} = T\bigl[(1-\alpha-\gamma)SB - C\bigr].
$$

Для $B=1\,000\,000$, $\alpha=0.60$, $\gamma=0.10$, $C=150\,000$, $S=1$ и, к примеру, $T=52$ недельных розыгрышей:

$$
\Pi_{\text{year}} = 52 \times \bigl[(1-0.60-0.10) \times 1 \times 1\,000\,000 - 150\,000\bigr]
$$

$$
\Pi_{\text{year}} = 52 \times \bigl[0.30 \times 1\,000\,000 - 150\,000\bigr] = 52 \times \bigl[300\,000 - 150\,000\bigr] = 52 \times 150\,000 = 7.8 \text{ млн у.е.}
$$

После налога 20 % (пример): $7.8 \text{ млн} \times (1 - 0.20) = 6.24 \text{ млн у.е.}$
Чтобы достичь заявленных (в другом контексте) 10.4 млн чистой прибыли, можно:

* увеличить частоту до $T \approx 90$ розыгрышей в год ($10.4 \text{ млн} / (0.8 \times 150\,000) \approx 86.67$);
* или снизить расходы ($\gamma + C$);
* или повысить цену/объём билетов, сохраняя доли.

---

#### 1.4. Эффект командного участия (рисковая перспектива для игрока)

| Показатель                                | Соло-игрок (1 билет) | Команда$b_j$ билетов, вклад 1 билет |
| --------------------------------------------------- | ---------------------------------- | ------------------------------------------------------------- |
| Шанс «словить» фонд                | $1/B$                            | $b_j/B$  (в $b_j$ раз выше)                       |
| Выплата при успехе                  | $F$                              | $F/b_j$                                                     |
| EV                                                  | $\alpha S$                       | $\alpha S$                                                  |
| Дисперсия (джек-пот-лотерея) | максимальная           | в$b_j$ раз ниже                                     |

*Игроки получают «страховку»: выше вероятность «почувствовать победу», пусть и меньшей суммой.*

---

#### 1.5. Варианты механик, влияющих на математику

| Механика                                                                                            | Формальный эффект                                                                                                                                                                                                                                 |
| ----------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Командный бонус (например + n % к выплате)                                    | Умножает часть фонда команды ⇒ EV билета становится$(1+n\%)\alpha S$; требует пересмотра $\alpha$ или введения спонсорского источника.                             |
| Командный джек-пот (доп. фонд, растущий от общего вклада)      | Добавляется к$F$, но распределяется только, если выиграла команда с ≥k участников ⇒ повышает EV *плотных* команд, создаёт стимул к кооперации. |
| Прогрессивная шкала долей (чем больше вклад, тем выше доля) | Делит$F$ не пропорционально $c_{ij}$, а по нелинейной функции ⇒ изменяет индивидуальный EV внутри команды, но не общий EV билета.                                |

---

#### 1.6. Ключевые выводы

1. **Шанс команды на джек-пот растёт линейно с числом общих билетов.** Это стимулирует игроков объединяться.
2. **Ожидаемая ценность одного билета неизменна ($\alpha S$) для игрока,** но варьируется риск-профиль: в команде выигрыши «чаще-но-мельче», соло — «реже-но-крупно».
3. **Прибыль оператора управляется параметрами $\alpha$ (доля в призовой фонд), $\gamma$ (переменные расходы) и $C$ (постоянные расходы).** Точка безубыточности задаётся их комбинацией. Это основные рычаги управления доходностью.
4. **Игровые стимулы** (бонусы, прогрессия долей) можно добавлять, не нарушая фундаментального равенства EV — нужно лишь компенсировать их в бюджете тиража (например, за счет операционной маржи или специального маркетингового фонда).

Такая модель делает прозрачными как пользовательские шансы, так и бизнес-метрики, что является основой для гибкой настройки продукта, управления доходностью и привлечения инвестиций.

---

### 2. Игра «Королевская Битва Чисел» (Number Battle Royale)

**Концепция Игры:**

«Королевская Битва Чисел» — это интерактивная лотерея с элементами игры на выбывание. Игроки выбирают числа из заданного диапазона. В несколько раундов часть чисел случайным образом отсеивается. Ключевой особенностью является то, что после каждого раунда отсева игроки, чьи числа остались "в игре", могут сменить свое число на любое другое из выжившего пула. Игра продолжается до тех пор, пока не останется одно единственное победное число.

**Математическая модель игры-лотереи «Королевская Битва Чисел»**

---

#### 2.1. Параметры и обозначения

| Символ                   | Значение                                                                 | Типовое (пример) |
| ------------------------------ | -------------------------------------------------------------------------------- | ----------------------------- |
| $N_0$                        | количество первоначальных чисел                     | 100                           |
| $N_k$                        | чисел, оставшихся после$k$-го этапа ( $N_K = 1$ ) | 100 → 50 → 20 → 2 → 1     |
| $s_k = \dfrac{N_k}{N_{k-1}}$ | «коэффициент выживания» шага$k$                      | 0.50, 0.40, 0.10, 0.50        |
| $B$                          | общее число проданных билетов                          | 10 000                        |
| $S$                          | цена одного билета                                               | 100 у.е.                    |
| $\alpha$                     | доля выручки, идущая в призовой фонд               | 0.50 (50 %)                   |

---

#### 2.2. Процесс розыгрыша

1. **Выбор:** Каждый билет фиксирует число $x \in \{1, \dots, N_0\}$.
2. **Отсев №1:** Генератор случайных чисел (ГСЧ) оставляет $N_1$ чисел из $N_0$.
3. **Опция смены:** Все билеты, чьи числа "выжили", могут *сменить* свой выбор на любое из $N_1$ оставшихся чисел.
4. **Повторение:** Шаги 2-3 повторяются для последующих этапов ($N_2, N_3, \dots, N_K$), пока не останется одно число ($N_K=1$) — оно и является победным.

> Замена числа повышает вовлечённость, но *не меняет* математический шанс билета оказаться на победном числе при условии оптимальной стратегии смены — см. ниже.

---

#### 2.3. Вероятность выигрыша одного билета

##### 2.3.1. Базовая стратегия «равный выбор среди выживших»

Если на каждом этапе игрок (или автоматическая система смены по его поручению) выбирает число равновероятно из текущего пула выживших чисел, то вероятность пережить шаг $k$ равна $s_k$. Общая вероятность выигрыша:

$$
P_{\text{win}}=\prod_{k=1}^{K}s_k = \frac{N_1}{N_0} \times \frac{N_2}{N_1} \times \dots \times \frac{N_K}{N_{K-1}} = \frac{N_K}{N_0}=\frac{1}{N_0}.
$$

Для $N_0=100$, $P_{\text{win}} = 1/100 = 1\%$.
Таким образом, возможность смены числа не улучшает ожидаемый шанс на выигрыш (он фиксирован как $1/N_0$), но делает процесс интерактивным и дает иллюзию контроля.

##### 2.3.2. Потенциал «социальной» стратегии

Если игроки видят, сколько билетов привязано к каждому числу (степень "популярности" числа), они могут стратегически переходить к менее «перегруженным» числам. Это не меняет их шанс $1/N_0$ на то, что *их билет* окажется на победном номере, но может повысить *ожидаемую выплату*, если они окажутся среди меньшего числа победителей, делящих общий приз. Модель ниже остается справедливой для любой стратегии смены числа; меняется лишь распределение выигрыша между победителями.

---

#### 2.4. Экономика тиража (Бизнес-модель)

##### 2.4.1. Фонд и ожидаемое число победителей

* Выручка: $R = S B$.
* Призовой фонд: $F = \alpha R = \alpha S B$.
* Математическое ожидание числа победителей (игроков, чьи билеты оказались на выигрышном номере):

  $$
  mathbb{E}[W] = B \cdot P_{\text{win}} = B \cdot \frac{1}{N_0} = \frac{B}{N_0}.
  $$

  Для примера: $B=10\,000$ билетов, $N_0=100$ чисел $\implies \mathbb{E}[W] = 10\,000/100 = 100$ победителей.

##### 2.4.2. Ожидаемая выплата одному победителю

Если все победители делят призовой фонд поровну:

$$
P = \frac{F}{\mathbb{E}[W]} = \frac{\alpha S B}{B/N_0} = \alpha S N_0.
$$

*Пример:* $S=100$ у.е., $\alpha=0.5$, $N_0=100$ чисел $\implies P = 0.5 \times 100 \times 100 = 5\,000$ у.е.

> Фактическая выплата отдельному победителю будет $F / W_{actual}$ (где $W_{actual}$ - фактическое число победителей) и может быть выше, если победителей оказалось меньше среднего (например, из-за неравномерного «распыления» билетов по числам).

##### 2.4.3. Ожидаемое значение (EV) для игрока

Математическое ожидание выигрыша для одного билета:

$$
\mathbb{E}[\text{выигрыш на билет}] = P_{\text{win}} \cdot P = \frac{1}{N_0} \cdot (\alpha S N_0) = \alpha S.
$$

Относительно ставки $S$, чистый EV (Net Expected Value):

$$
\text{EV}_{\text{нетто}} = \alpha S - S = -(1-\alpha)S.
$$

При $\alpha = 0.5$ (50% в призовой фонд) $\implies \text{EV}_{\text{нетто}} = -(1-0.5)S = -0.5S$. То есть, игрок в среднем теряет 50% от стоимости билета, что соответствует доле, забираемой оператором.

##### 2.4.4. Маржа организатора

Валовая маржа оператора от оборота (до операционных расходов и налогов):

$$
\text{Маржа} = 1-\alpha.
$$

Для $\alpha=0.5$, маржа = $1 - 0.5 = 0.50$ (50%).
Любое значение $\alpha \in [0.3, 0.5]$ обычно соответствует нормативным требованиям к лотереям (призовой фонд 50–70% от выручки, если считать от чистой выручки после налогов с оборота, или если $\alpha$ это доля от выручки до всех вычетов). Если $\alpha$ это доля от выручки, идущая *непосредственно* в призовой фонд, то $1-\alpha$ это валовая маржа до вычета всех расходов и налогов.

---

#### 2.5. Гибкие рычаги настройки (Управление бизнес-моделью)

| Параметр                                     | Экономика                                                                                                                                                                                                                                     | Игровой эффект                                                                                                                                                                                                           |
| ---------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $N_0$ (размер вселенной чисел) | Инвертирует шанс победы ($1/N_0$) и среднее число победителей. При фиксированном $F$, чем меньше $\mathbb{E}[W]$ (т.е. больше $N_0$), тем больше $P$. | Чем больше$N_0$, тем реже индивидуальные победы, но тем выше размер потенциального единичного выигрыша («джек-потный» эффект). |
| Маска$\{N_k\}$ (этапы отсева)      | *Не влияет* на итоговый шанс $P_{\text{win}}$ и EV.                                                                                                                                                                         | Формирует «ритм» и напряжение игры (частота отсевов, общая длительность тиража). Влияет на UX.                                                             |
| $\alpha$ (доля в призовой фонд)   | Линейно меняет EV игрока и маржу оператора.                                                                                                                                                                          | Высокое$\alpha$ делает игру «щедрее» (EV ближе к нулю для игрока), низкое — «жестче» (выше маржа оператора).                                           |
| Цена билета$S$                           | Масштабирует всю экономику (выручку, призовой фонд, EV в денежном выражении).                                                                                                             | Просто крупнее/мельче ставки и выплаты, не меняя относительные пропорции.                                                                                               |

---

#### 2.6. Контроль честности

* **Commit-Reveal RNG:** Перед стартом тиража сервис может публиковать криптографический хэш от "зерна" (seed) ГСЧ, который будет использован для розыгрыша.
* **Раскрытие Seed:** После завершения тиража и определения победителей, seed раскрывается. Любой желающий может, зная seed и алгоритм, воспроизвести последовательность отсевов и убедиться, что победное число получено без манипуляций.
* **Публикация параметров:** Все ключевые параметры тиража ($N_0, \{N_k\}, \alpha, S$) должны быть зафиксированы и опубликованы (например, в публичном логе или смарт-контракте) до начала продаж билетов.

---

#### 2.7. Ключевые выводы

* **Вероятность победы каждого билета при честной игре и оптимальной стратегии равна $1/N_0$, *независимо* от того, меняет ли игрок свой выбор между этапами.** Это важный аспект для понимания честности игры.
* **Экономика тиража полностью описывается парой ключевых параметров $(\alpha, S)$** (при заданных $N_0$ и $B$). Контроль маржи оператора сводится к выбору $\alpha$.
* **Глубина геймплея достигается драматургией последовательных отсевов** и психологией «правильной замены» числа, что повышает вовлеченность, не нарушая при этом прозрачность и предсказуемость математической модели.

---

#### 2.8. Экономика одного тиража «Королевской Битвы Чисел» — раз-за-разом (Сводная таблица и пример)

| Обозначение            | Что это такое                                                                              | Как считается                                                     | Почему важно (для бизнес-модели)                                                                                                                   |
| --------------------------------- | ----------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $S$                             | Цена одного билета                                                                    | Назначается организатором                             | Чем выше$S$ — тем крупнее *все* денежные потоки (доход, приз, прибыль).                                               |
| $B$                             | Продано билетов                                                                         | Фиксируется по факту продаж                           | Увеличивает масштаб тиража без изменения долей.                                                                                     |
| $R$                             | *Выручка* (общий сбор)                                                              | $R = S \times B$                                                            | Деньги, собранные до распределения. Ключевой показатель оборота.                                                      |
| $\alpha$                        | Доля выручки, идущая в*призовой фонд*                                 | Административный параметр                             | Управляет балансом «привлекательность для игрока ↔️ валовая маржа оператора».                            |
| $F$                             | Призовой фонд                                                                             | $F = \alpha R$                                                              | Сколько денег гарантированно уходит игрокам-победителям.                                                                   |
| $1-\alpha$                      | *Валовая маржа* оператора (доля от выручки)                       | $(R - F)/R$ или просто $1-\alpha$                                | Остаётся на покрытие операционных затрат, налогов и формирование чистой прибыли.                        |
| $N_0$                           | Диапазон чисел в игре (начальное количество)                     | Задается организатором (например, 100)           | Обратная величина шанса любого билета победить ($1/N_0$). Влияет на джекпотный эффект.                    |
| $P_{\text{win}}$                | Шанс победы одного билета                                                       | $1/N_0$                                                                     | Не зависит от смены числа, стадий отсевов и количества соперников (при оптимальной стратегии). |
| $\mathbb{E}[W]$                 | *Ожидаемое* число победителей                                              | $B/N_0$                                                                     | Позволяет предварительно оценить, сколько победителей разделят приз.                                             |
| $P$                             | *Ожидаемый* приз на одного победителя                                | $P = F / \mathbb{E}[W] = \alpha S N_0$                                      | Растёт линейно с ценой билета,$\alpha$ и размером вселенной чисел $N_0$.                                                 |
| $\text{EV}_{\text{игрок}}$ | Ожидаемая ценность билета (чистая, после вычета ставки) | $\alpha S - S = -(1-\alpha)S$                                               | Сколько в среднем «теряет» игрок (или «зарабатывает» оператор) с одного проданного билета.       |
| $\Pi_{\text{операц}}$     | Операционная прибыль тиража                                                  | $(1-\alpha)R - \text{Операционные расходы тиража}$ | Прибыль до налогов.                                                                                                                                          |
| $\Pi_{\text{чистая}}$     | *Чистая* прибыль оператора с тиража                                    | $\Pi_{\text{операц}} - \text{Налоги}$                           | Итоговый финансовый результат для оператора.                                                                                          |

---

##### 2.8.1. Поток денег в базовом примере

(Параметры: $B = 10\,000$ билетов, $S = 100$ у.е./билет, $\alpha = 0.50$)

1. **Выручка (R):** $10\,000 \text{ билетов} \times 100 \text{ у.е.} = 1\,000\,000 \text{ у.е.}$
2. **Призовой фонд (F):** $1\,000\,000 \text{ у.е.} \times 0.50 = 500\,000 \text{ у.е.}$
3. **Валовая маржа оператора (до расходов):** $1\,000\,000 \text{ у.е.} - 500\,000 \text{ у.е.} = 500\,000 \text{ у.е.}$ (или $1\,000\,000 \text{ у.е.} \times (1-0.50)$)

   *Предположим операционные расходы (маркетинг, эквайринг, серверы и т.д.) составляют 30% от выручки:*
4. **Операционные расходы:** $1\,000\,000 \text{ у.е.} \times 0.30 = 300\,000 \text{ у.е.}$
5. **Прибыль до налогообложения:** $500\,000 \text{ у.е.} (валовая маржа) - 300\,000 \text{ у.е.} (расходы) = 200\,000 \text{ у.е.}$

   *Предположим налог на прибыль составляет 20%:*
6. **Налог на прибыль:** $200\,000 \text{ у.е.} \times 0.20 = 40\,000 \text{ у.е.}$
7. **Чистая прибыль оператора с тиража:** $200\,000 \text{ у.е.} - 40\,000 \text{ у.е.} = 160\,000 \text{ у.е.}$ (что составляет $16\%$ от первоначальной выручки).

Визуализация флоу:

* Игроки платят            1 000 000 у.е.   (R)
* Призовой фонд          500 000 у.е.   (F, это αR)
* Валовая маржа          500 000 у.е.   (это (1-α)R)
* Операционные      300 000 у.е.   (пример, \~30 % R)
* Прибыль до налога 200 000 у.е.
* Налог на прибыль   40 000 у.е.   (пример, \~20 % от прибыли до налога)
* Чистая прибыль    160 000 у.е.   (пример, ≈16 % R)

---

##### 2.8.2. Как изменения параметров «двигают» экономику (Влияние на бизнес-модель)

| Что меняем (Параметр)                                                                     | Что происходит (Эффект)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ---------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Поднять$\alpha$ (долю призового фонда) (например, с 0.50 до 0.60)    | • У игроков EV нетто становится$-(1-0.6)S = -0.4S$ (теряют меньше) → игра привлекательнее. • Валовая маржа оператора падает до $1-0.6 = 0.40$ (40%). Оператору для сохранения прибыли нужны больший объём продаж или более высокая операционная эффективность (меньшие относительные расходы).                                                                                                                  |
| Увеличить$N_0$ (начальное кол-во чисел) (например, с 100 до 1000) | • Шанс победы для одного билета падает с$1/100$ до $1/1000$. • При тех же $F$ (призовом фонде), $\mathbb{E}[W]$ (ожидаемое число победителей) падает в 10 раз. • Следовательно, $P$ (ожидаемый приз на одного победителя) вырастет в 10 раз ($P = \alpha S N_0$). Это создает «джек-потный» эффект: выиграть сложнее, но выигрыш крупнее.                                                            |
| Поднять цену билета$S$                                                                  | • Линейно растёт и$\text{EV}_{\text{игрок}}$ (в абсолютном денежном выражении его потерь или выигрышей), и все денежные потоки оператора (выручка, валовая маржа в деньгах, потенциальная прибыль). Экономические *доли* (как % от $S$ или $R$) сохраняются.                                                                                                                                                                          |
| Продать больше билетов$B$                                                            | • Всё масштабируется пропорционально: общий призовой фонд$F$, валовая маржа оператора в деньгах, и т.д. • Средний *ожидаемый* приз на одного победителя ($P = \alpha S N_0$) и индивидуальный шанс победы ($P_{\text{win}} = 1/N_0$) *не меняются*, так как они не зависят от $B$ напрямую (хотя $F$ и $\mathbb{E}[W]$ растут с $B$, их отношение $P$ остается постоянным). |

---

##### 2.8.3. Риски и «хвосты» распределения (Нюансы для оператора)

* **Количество фактических победителей $W$ не фиксировано, а является случайной величиной.**
  * Если билетов, оказавшихся на победном числе, будет *меньше* среднего ожидаемого ($\mathbb{E}[W]$), то фактический приз на одного человека $F/W$ *растёт* (эффект джек-пота для счастливчиков).
  * Если их окажется *сильно больше* среднего, выплата на каждого будет меньше $P$. Оператор при этом не несёт прямого убытка сверх запланированного призового фонда $F$, так как общий фонд $F$ заранее зарезервирован и не превышается. Риск здесь скорее репутационный, если выплаты станут слишком мелкими.
* **Операционные расходы должны быть под контролем** и в идеале составлять предсказуемую долю от валовой маржи $(1-\alpha)R$, иначе маржа может быть «съедена», приводя к убыткам.
* **Налогообложение:** Налоги обычно считаются с прибыли (доход минус расход). Поэтому более высокий $\alpha$ (ниже валовая маржа) ведёт к меньшей базе для налогообложения прибыли, но и к меньшему брутто-доходу для покрытия операционных расходов.

---

##### 2.8.4. Краткий рецепт настройки игры под бизнес-цели

1. **Задаём целевую валовую маржу оператора (как % от выручки):** Это напрямую определяет $\alpha = 1 - \text{целевая маржа}$. (Например, если хотим маржу 40%, то $\alpha=0.60$).
2. **Определяем желаемый средний размер индивидуального приза $P$ для победителя:** Исходя из этого, подбираем комбинацию цены билета $S$ и начального количества чисел $N_0$ по формуле $P = \alpha S N_0$. (Например, если $\alpha=0.60$ и хотим $P=6000$, то $S \cdot N_0 = 10000$. Это может быть $S=100, N_0=100$ или $S=50, N_0=200$ и т.д.).
3. **Проверяем юнит-экономику:** Оценка ожидаемого количества проданных билетов $B$ должна генерировать достаточную валовую маржу $(1-\alpha)S B$ для покрытия всех операционных расходов и достижения целевой чистой прибыли.
4. **Тестируем UX-ритм:** Настраиваем количество стадий отсева и коэффициенты выживания $\{N_k\}$ (маску отсева). Это *не влияет* на базовую экономику (EV, $P_{\text{win}}$), но критически важно для создания увлекательного и напряженного игрового опыта.

Эта детализация показывает, какие параметры являются ключевыми рычагами для управления шансами на выигрыш, размером выигрыша, доходностью оператора и общим восприятием игры пользователем.

---

### 3. Игра «Минное Поле: Дуэль» (Minesweeper: Duel)

**Концепция Игры:**

«Минное Поле: Дуэль» — это PvP (игрок против игрока) адаптация классической игры "Сапёр". Два игрока делают одинаковые ставки. На игровом поле размером $N$ ячеек случайным образом скрыто $M$ мин. Игроки ходят по очереди (или одновременно, в зависимости от правил конкретной реализации), выбирая ячейки. Если игрок открывает ячейку с миной, он проигрывает (или "подрывается"). Цель — заставить соперника подорваться или выполнить другие условия победы (например, набрать больше очков за открытие безопасных клеток). Приз, сформированный из ставок (за вычетом комиссии оператора), достается победителю.

**Математическая модель игры «Минное Поле: Дуэль»**

---

#### 3.1. Параметры

| Обозначение | Смысл                                                                                                   | Типовое значение |
| ---------------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------- |
| $N$                  | общее число ячеек на игровом поле                                                | 25 (поле 5x5)               |
| $M$                  | общее число мин, скрытых на поле                                                   | 5                               |
| $S$                  | ставка, которую вносит каждый из двух игроков в начале игры | 50 у.е.                       |
| $P$                  | приз, выплачиваемый победителю оператором                               | 80 у.е.                       |

**Дополнительные производные величины:**

* Доля (или начальная вероятность) мин на поле: $p_m = \dfrac{M}{N}$
* Доля (или начальная вероятность) безопасных ячеек: $p_s = 1-p_m = \dfrac{N-M}{N}$

---

#### 3.2. Одно рандомное («микро-») сражение / один ход

Рассмотрим упрощенный сценарий, где в каждом раунде оба игрока одновременно и независимо выбирают по одной ранее не открытой ячейке. Предполагаем, что при отсутствии информации (в начале игры или если нет возможности логически вычислить безопасные клетки) выбор каждой ячейки равновероятен.

| Событие (для одного игрока, назовем его "Пользователь")      | Вероятность (при условии случайного выбора ячейки) |
| -------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------- |
| Только соперник подрывается (победа Пользователя)             | $p_s \cdot p_m$                                                                             |
| Только Пользователь подрывается (проигрыш Пользователя) | $p_m \cdot p_s$                                                                             |
| Оба подрываются одновременно (ничья или особый исход)       | $p_m^2$                                                                                     |
| Оба выбирают безопасные ячейки (игра продолжается)            | $p_s^2$                                                                                     |

*Примечание: Эти вероятности актуальны для первого хода или для ситуации, когда состояние поля (расположение мин) полностью неизвестно обоим игрокам.*

---

#### 3.3. Полная партия (повтор раундов «до первого взрыва» или другого исхода)

Игра продолжается, пока один из игроков не подорвется или не будут выполнены другие условия окончания партии. Вероятность того, что текущий раунд (один одновременный выбор) завершает партию (т.е. хотя бы одна мина сработает):

$$
q = 1 - p_s^2 = 1 - (1-p_m)^2 = 1 - (1 - 2p_m + p_m^2) = 2p_m - p_m^2
$$

Это вероятность того, что не произойдет событие "оба целы".

##### 3.3.1. Вероятности окончательных исходов для симметричной игры (при условии, что игра заканчивается, как только кто-то подорвался)

Если мы рассматриваем исходы относительно одного из игроков (Пользователя):

$$
\text{Вероятность Пользователю выиграть (соперник подорвался, Пользователь нет): } P_{\text{win}} = \frac{p_s p_m}{q}
$$

$$
\text{Вероятность Пользователю проиграть (Пользователь подорвался, соперник нет): } P_{\text{lose}} = \frac{p_m p_s}{q}
$$

$$
\text{Вероятность ничьей (оба подорвались): } P_{\text{double}} = \frac{p_m^2}{q}
$$

Сумма этих вероятностей: $\frac{p_s p_m + p_m p_s + p_m^2}{2p_m - p_m^2} = \frac{2p_s p_m + p_m^2}{p_m(2-p_m)}$.
Поскольку $p_s = 1-p_m$: $\frac{2(1-p_m)p_m + p_m^2}{p_m(2-p_m)} = \frac{2p_m - 2p_m^2 + p_m^2}{p_m(2-p_m)} = \frac{2p_m - p_m^2}{p_m(2-p_m)} = \frac{p_m(2-p_m)}{p_m(2-p_m)} = 1$.

**Пример расчета для $N=25, M=5$:**

* $p_m = M/N = 5/25 = 0.2$
* $p_s = (N-M)/N = 20/25 = 0.8$
* $q = 2p_m - p_m^2 = 2(0.2) - (0.2)^2 = 0.4 - 0.04 = 0.36$
* $P_{\text{win}} = \dfrac{0.8 \cdot 0.2}{0.36} = \dfrac{0.16}{0.36} = \dfrac{16}{36} = \mathbf{\dfrac49} \approx 44.44\%$
* $P_{\text{lose}} = \dfrac{0.2 \cdot 0.8}{0.36} = \dfrac{0.16}{0.36} = \mathbf{\dfrac49} \approx 44.44\%$ (симметрично)
* $P_{\text{double}} = \dfrac{(0.2)^2}{0.36} = \dfrac{0.04}{0.36} = \dfrac{4}{36} = \mathbf{\dfrac19} \approx 11.11\%$

##### 3.3.2. Математическое ожидание выплаты и маржа оператора (Бизнес-модель)

Общий банк игры от двух игроков = $2S$.
Оператор выплачивает победителю $P$. (Если ничья $P_{\text{double}}$ означает возврат ставок или другой исход, это нужно учесть отдельно. Предположим, при $P_{\text{double}}$ ставки возвращаются или игра переигрывается, и оператор получает доход только если есть явный победитель).

Если выплата $P$ производится только при чистой победе одного из игроков (исходы $P_{\text{win}}$ или $P_{\text{lose}}$ для Пользователя), а ставку $S$ вносит каждый игрок, то для одного конкретного участника (Пользователя):

* Математическое ожидание выигрыша Пользователя (сумма, которую он получит от оператора в среднем за игру):
  $\mathbb{E}[\text{выплата игроку}] = P_{\text{win}} \cdot P$
* Математическое ожидание дохода оператора с одной игры (с учетом ставок обоих игроков):
  Общий сбор $2S$. Общая выплата $P$.
  $\mathbb{E}[\text{доход оператора с игры}] = 2S - P$.
  Это при условии, что всегда есть один победитель, которому выплачивается $P$.
  Если учитывать $P_{\text{double}}$ как возврат ставок, то:
  $\mathbb{E}[\text{доход оператора с игры}] = (P_{\text{win}} + P_{\text{lose}})(S - P/2) + P_{\text{double}}(0)$. Это не совсем так.
  Проще: с каждой игры, где есть победитель, оператор зарабатывает $2S - P$. Таких игр $(P_{\text{win}} + P_{\text{lose}})$ доля.
  Доход оператора с одного игрока (его ставки $S$):
  $\mathbb{E}[\text{прибыль оператора с одного игрока}] = S - P_{\text{win}} \cdot P$
  *(Это если $P$ - это то, что получает победитель сверх своей ставки. Если $P$ - это вся сумма, которую получает победитель, включая свою ставку, то модель немного другая. В условии $P$ - приз победителю (выплата оператором), $S$ - ставка. Логично, что $P$ - это то, что победитель получает от оператора. Банк $2S$. Оператор берет $2S-P$ как комиссию.)*

Комиссия оператора (Rake) с каждой игры, где есть победитель: $2S - P$.
Относительная маржа оператора (от общего банка $2S$):

$$
\text{Margin} = \frac{2S - P}{2S} = 1 - \frac{P}{2S}
$$

Это при условии, что $P_{\text{double}}$ приводит к переигровке без комиссии или возврату ставок. Если при $P_{\text{double}}$ ставки уходят оператору, то маржа будет выше.

Если использовать $P=80$ у.е. при $S=50$ у.е.:
Общий банк $2 \times 50 = 100$ у.е. Приз победителю $P=80$ у.е.
Комиссия оператора = $100 - 80 = 20$ у.е. с каждой игры, где есть победитель.
Относительная маржа = $20 / 100 = 0.20$ или $20\%$.

Используя вероятности:
$\mathbb{E}[\text{выплата игроку от оператора}] = P_{\text{win}} \cdot P = \frac{4}{9} \cdot 80 \approx 0.4444 \cdot 80 = 35.55$ у.е.
Чистый EV для игрока = $\mathbb{E}[\text{выплата игроку}] - S = 35.55 - 50 = -14.45$ у.е.
Это означает, что в среднем игрок теряет $14.45$ у.е. за игру.
Суммарный EV для двух игроков = $2 \times (-14.45) = -28.90$ у.е.
Эта сумма должна соответствовать ожидаемому доходу оператора, если $P_{\text{double}}$ приводит к возврату ставок.

Если $P_{\text{double}}$ (вероятность $\frac{1}{9}$) означает возврат ставок $S$ обоим, то:
Ожидаемый доход оператора = $(P_{\text{win}} + P_{\text{lose}}) \cdot (2S - P) = (\frac{4}{9} + \frac{4}{9}) \cdot (2 \cdot 50 - 80) = \frac{8}{9} \cdot (100 - 80) = \frac{8}{9} \cdot 20 \approx 0.8889 \cdot 20 = 17.78$ у.е. с игры.
Это $17.78\%$ от общего банка $2S=100$.

Если же рассматривать маржу на одного участника из примера с $P_{\text{win}} = 0.444, S=50, P=80$:
$\mathbb{E}[\text{прибыль оператора с одного игрока, если его ставка уходит в фонд выплаты}] = S - P_{\text{win}} \cdot P = 50 - (0.4444 \cdot 80) = 50 - 35.55 = 14.45$ у.е.
Относительная маржа с одного игрока = $14.45 / 50 = 0.289$ или $28.9\%$.
Тогда с двух игроков ожидаемая прибыль оператора $2 \times 14.45 = 28.90$ у.е. Это расхождение с $17.78$ у.е. возникает из-за интерпретации $P_{\text{double}}$.

Вернемся к формуле из вашего текста: $\text{Margin} = 1 - P_{\text{win}}\frac{P}{S}$.
Эта формула означает маржу относительно *одной* ставки $S$, как если бы оператор гарантировал выплату $P$ при вероятности выигрыша $P_{\text{win}}$ из фонда, равного ставке $S$.
Пример ($S=50, P=80, P_{\text{win}} = 4/9 \approx 0.4444$):
$\text{Margin} = 1 - \frac{4}{9} \cdot \frac{80}{50} = 1 - \frac{4}{9} \cdot 1.6 = 1 - \frac{6.4}{9} = 1 - 0.7111 = 0.2889$ или $28.9\%$.
Это означает, что $28.9\%$ от ставки *каждого* игрока идет оператору, если этот игрок *не выиграл*.

Чтобы оператор имел маржу $\mu$ (например, 30% или 0.3) с каждой ставки $S$, приз $P$ должен быть таким, чтобы:
$S - P_{\text{win}} \cdot P = \mu S \implies P_{\text{win}} \cdot P = (1-\mu)S \implies P = \dfrac{(1-\mu)S}{P_{\text{win}}}$.
Пример: $\mu=0.30$, $S=50$, $P_{\text{win}}=4/9$:
$P = \dfrac{(1-0.30) \cdot 50}{4/9} = \dfrac{0.70 \cdot 50}{4/9} = \dfrac{35}{4/9} = \dfrac{35 \cdot 9}{4} = \dfrac{315}{4} = 78.75$ у.е.
В этом случае, если игрок выигрывает, он получает 78.75 у.е. Ставка была 50.
Чистый EV для игрока = $P_{\text{win}} \cdot P - S = \frac{4}{9} \cdot 78.75 - 50 = 35 - 50 = -15$ у.е.
$-15 / 50 = -0.30$, что соответствует марже оператора в 30%.

---

#### 3.4. Гибкость модели и управление бизнес-показателями

| Элемент                                            | Как задаётся (Управляется оператором)                                           | Влияние на игру и экономику                                                                                                                                                                                                                                                                                                                                                                      |
| --------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Размер поля$(N)$ и число мин $(M)$ | Конфигурационные параметры игры                                                    | Изменяют$p_m$ и $p_s$, следовательно, вероятности $P_{\text{win}}, P_{\text{lose}}, P_{\text{double}}$. Это напрямую влияет на баланс риска, сложность игры и, как следствие, на маржу при фиксированном $P/S$.                                                                                 |
| Cтавка$(S)$                                        | Задается для каждого стола/игры (может быть выбор у игрока)     | Линейно масштабирует все денежные потоки: и ставки, и потенциальный выигрыш$P$ (если $P$ привязано к $S$), и доход оператора.                                                                                                                                                                                        |
| Приз$(P)$                                           | Задается оператором (может быть фиксированным или % от банка) | Напрямую влияет на привлекательность игры для пользователя и на маржу оператора. Связан с$S$ и $P_{\text{win}}$ через формулу маржи.                                                                                                                                                                                  |
| Поведение игроков (стратегии)    | Не управляется напрямую, но можно анализировать                        | Если игроки используют продвинутые стратегии (не случайный выбор), вероятности$P_{\text{win}}$ могут меняться, что потребует корректировки $P$ для сохранения целевой маржи. Модель предполагает базовую случайность для простоты. |

Оператор может установить целевую маржу $\mu$ (например, 20-30% от ставки каждого игрока) и автоматически рассчитывать приз $P$ для выплаты победителю по формуле:

$$
P = \dfrac{(1-\mu)S}{P_{\text{win}}}
$$

где $P_{\text{win}}$ рассчитывается на основе $N$ и $M$.

---

#### 3.5. Расширения для геймификации

| Идея                                                    | Математический крючок (Как это влияет на модель)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ----------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ⭐️ Динамический джек-пот               | Часть комиссии оператора (например, небольшой % от$2S-P$) может накапливаться в отдельный джекпот. Вероятность сорвать джекпот может быть привязана к редким событиям, например, к "двойному взрыву" ($P_{\text{double}}$), если он не ведет к возврату ставок.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ⭐️ Буст-перки за бонусную валюту | Игроки могут покупать за внутриигровую валюту (не влияющую на реальные денежные ставки) перки, например, "посмотреть одну ячейку без риска" (ограниченное количество раз). Это меняет локальные вероятности для игрока, но основная экономика ставок$S$ и приза $P$ остается под контролем оператора. Важно, чтобы такие перки не нарушали честность игры по отношению к вероятностям выигрыша реальных денег. Перки могут влиять на $P$ (например, увеличивая его для VIP-игроков за счет снижения маржи оператора для них), но не на $P_{\text{win}}$ фундаментально. |
| ⭐️ Ранговая система (Elo-подобная) | Результаты дуэлей (победа/проигрыш/ничья) могут использоваться для обновления рейтинга игроков. Это не влияет напрямую на экономику одной игры, но повышает долгосрочную вовлеченность.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

---

#### 3.6. Ключевые выводы

* **Прозрачная экономика:** Модель позволяет точно рассчитать вероятности всех исходов и ожидаемые значения для игрока и оператора. Это облегчает автоматический контроль маржи и соблюдение нормативных требований (например, по общему призовому фонду, если он регулируется).
* **Симметричность и честность:** В базовой модели игра симметрична для обоих игроков, что гарантирует честность. Различия в итоговых выплатах и доходе оператора создаются исключительно на уровне экономических параметров ($S, P, \mu$), а не за счет изменения шансов одного игрока против другого.
* **Гибкость для геймификации:** Различные геймификационные надстройки (VIP-статусы, бонусы, рейтинги, джекпоты) могут быть интегрированы поверх базовой математической модели, корректируя параметры $S$ и $P$ или вводя дополнительные фонды, не нарушая основного вероятностного ядра игры.
* **Управление рисками:** Оператор может четко контролировать свою маржу, настраивая соотношение $N, M, S, P$.

Эта игра предлагает высокий уровень вовлеченности за счет прямого соперничества и знакомой механики, при этом обеспечивая оператору предсказуемую доходность.
